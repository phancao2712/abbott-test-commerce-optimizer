/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as f}from"@dropins/tools/preact-jsx-runtime.js";import{useState as u,useCallback as p,useEffect as g,useMemo as v}from"@dropins/tools/preact-hooks.js";import{Picker as x}from"@dropins/tools/components.js";import{events as C}from"@dropins/tools/event-bus.js";import{g as w}from"../chunks/customerCompanies.js";import"@dropins/tools/fetch-graphql.js";const I=()=>{const[r,m]=u([]),[c,a]=u({text:"",value:""}),i=p(async()=>{var e,n;try{const t=await w();m(t.customerCompanies),(e=t.currentCompany)!=null&&e.name&&((n=t.currentCompany)!=null&&n.id)&&a({text:t.currentCompany.name,value:t.currentCompany.id})}catch(t){console.error("Failed to load company data:",t)}},[]),s=p(e=>{const t=e.target.value,o=r.find(h=>h.value===t);o&&a(o),C.emit("companyContext/changed",t)},[r]),l=p(()=>{m([]),a({text:"",value:""})},[]),y=p(e=>{e?i():l()},[i,l]),d=p(e=>{m(n=>{const t=n.find(o=>o.value===e);return t&&a(t),n})},[]);return g(()=>{const e=C.on("authenticated",y,{eager:!0}),n=C.on("companyContext/restored",d);return()=>{var t,o;(t=e==null?void 0:e.off)==null||t.call(e),(o=n==null?void 0:n.off)==null||o.call(n)}},[y,d]),{companies:r,currentCompany:c,handleCompanyChange:s}},F=({ariaLabel:r,...m})=>{const{companies:c,currentCompany:a,handleCompanyChange:i}=I(),s=v(()=>c,[c]);return c.length<2?null:f("div",{...m,children:f(x,{options:s,value:a.value,onChange:i,"aria-label":r||"Select company","aria-describedby":"company-switcher-description"})})};export{F as CompanySwitcher,F as default,I as useCompanyData};
//# sourceMappingURL=CompanySwitcher.js.map
